@model IEnumerable<TournamentApp.Models.Match>

@{
    ViewData["Title"] = $"–ú–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞ {ViewBag.Tournament.Name}";
    var tournament = ViewBag.Tournament as TournamentApp.Models.Tournament;
    var groupMatches = Model.Where(m => m.Type == TournamentApp.Models.MatchType.Group).ToList();
    var playoffMatches = Model.Where(m => m.Type == TournamentApp.Models.MatchType.Playoff).ToList();
    var finalMatches = Model.Where(m => m.Type == TournamentApp.Models.MatchType.Final).ToList();
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="text-center">–ú–∞—Ç—á–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h1>
        <h4 class="text-muted text-center">@tournament.Name</h4>
    </div>
    <div>
        @if (!tournament.PlayoffGenerated && groupMatches.Any(m => m.IsCompleted))
        {
            <form asp-action="GeneratePlayoff" asp-route-id="@tournament.Id" method="post" class="d-inline">
                <button type="submit" class="btn btn-warning me-2">
                    <i class="bi bi-star"></i> –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–µ–π-–æ—Ñ—Ñ
                </button>
            </form>
        }
        <a asp-action="Standings" asp-route-id="@tournament.Id" class="btn btn-success me-2">
            <i class="bi bi-trophy"></i> –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        </a>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º
        </a>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        <h4 class="alert-heading">–ú–∞—Ç—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
        <p>–í —ç—Ç–æ–º —Ç—É—Ä–Ω–∏—Ä–µ –ø–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç—á–µ–π.</p>
    </div>
}
else
{
    @if (groupMatches.Any())
    {
        <div class="mb-5">
            <h3 class="text-center mb-4">
                <i class="bi bi-grid-3x3-gap"></i> –ì—Ä—É–ø–ø–æ–≤–∞—è —Å—Ç–∞–¥–∏—è
            </h3>
            <div class="row">
                @foreach (var match in groupMatches)
                {
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100 @(match.IsCompleted ? "border-success" : "border-warning")">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span class="badge @(match.IsCompleted ? "bg-success" : "bg-warning")">
                                    @(match.IsCompleted ? "–ó–∞–≤–µ—Ä—à–µ–Ω" : "–û–∂–∏–¥–∞–µ—Ç")
                                </span>
                                <small class="text-muted">–ì—Ä—É–ø–ø–æ–≤–æ–π –º–∞—Ç—á #@match.Id</small>
                            </div>
                            <div class="card-body text-center">
                                <div class="row align-items-center">
                                    <div class="col-4">
                                        <h6 class="mb-0">@match.HomeParticipant.Name</h6>
                                    </div>
                                    <div class="col-4 text-center">
                                        @if (match.IsCompleted)
                                        {
                                            <h5 class="mb-0 fw-bold" style="white-space: nowrap;">@(match.HomeScore ?? 0) - @(match.AwayScore ?? 0)</h5>
                                        }
                                        else
                                        {
                                            <h5 class="mb-0 text-muted">vs</h5>
                                        }
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-0">@match.AwayParticipant.Name</h6>
                                    </div>
                                </div>
                                
                                @if (match.IsCompleted)
                                {
                                    <div class="mt-3">
                                        @if (match.Result == TournamentApp.Models.MatchResult.HomeWin)
                                        {
                                            <span class="badge bg-primary">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: @match.HomeParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.AwayWin)
                                        {
                                            <span class="badge bg-primary">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: @match.AwayParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.Draw)
                                        {
                                            <span class="badge bg-secondary">–ù–∏—á—å—è</span>
                                        }
                                    </div>
                                }
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        @if (match.IsCompleted)
                                        {
                                            @if (match.PlayedAt.HasValue)
                                            {
                                                <i class="bi bi-calendar"></i> @match.PlayedAt.Value.ToString("dd.MM.yyyy HH:mm")
                                            }
                                            else
                                            {
                                                <i class="bi bi-check-circle"></i> @("–ó–∞–≤–µ—Ä—à–µ–Ω")
                                            }
                                        }
                                        else
                                        {
                                            <i class="bi bi-clock"></i> @("–ù–µ —Å—ã–≥—Ä–∞–Ω")
                                        }
                                    </small>
                                    <a asp-controller="Matches" asp-action="Edit" asp-route-id="@match.Id" 
                                       class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    @if (playoffMatches.Any())
    {
        <div class="mb-5">
            <h3 class="text-center mb-4">
                <i class="bi bi-award"></i> –ü–ª–µ–π-–æ—Ñ—Ñ (–ü–æ–ª—É—Ñ–∏–Ω–∞–ª)
            </h3>
            <div class="row justify-content-center">
                @foreach (var match in playoffMatches)
                {
                    <div class="col-md-6 col-lg-5 mb-4">
                        <div class="card h-100 border-info @(match.IsCompleted ? "bg-light" : "")">
                            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                <span class="badge @(match.IsCompleted ? "bg-success" : "bg-warning")">
                                    @(match.IsCompleted ? "–ó–∞–≤–µ—Ä—à–µ–Ω" : "–û–∂–∏–¥–∞–µ—Ç")
                                </span>
                                <small>–ü–æ–ª—É—Ñ–∏–Ω–∞–ª #@match.Id</small>
                            </div>
                            <div class="card-body text-center">
                                <div class="row align-items-center">
                                    <div class="col-4">
                                        <h6 class="mb-0 fw-bold">@match.HomeParticipant.Name</h6>
                                    </div>
                                    <div class="col-4 text-center">
                                        @if (match.IsCompleted)
                                        {
                                            <h4 class="mb-0 fw-bold text-primary" style="white-space: nowrap;">@(match.HomeScore ?? 0) - @(match.AwayScore ?? 0)</h4>
                                        }
                                        else
                                        {
                                            <h4 class="mb-0 text-muted">vs</h4>
                                        }
                                    </div>
                                    <div class="col-4">
                                        <h6 class="mb-0 fw-bold">@match.AwayParticipant.Name</h6>
                                    </div>
                                </div>
                                
                                @if (match.IsCompleted)
                                {
                                    <div class="mt-3">
                                        @if (match.Result == TournamentApp.Models.MatchResult.HomeWin)
                                        {
                                            <span class="badge bg-success fs-6">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: @match.HomeParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.AwayWin)
                                        {
                                            <span class="badge bg-success fs-6">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: @match.AwayParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.Draw)
                                        {
                                            <span class="badge bg-secondary fs-6">–ù–∏—á—å—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∏–≥—Ä–æ–≤–∫–∞)</span>
                                        }
                                    </div>
                                }
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        @if (match.IsCompleted)
                                        {
                                            @if (match.PlayedAt.HasValue)
                                            {
                                                <i class="bi bi-calendar"></i> @match.PlayedAt.Value.ToString("dd.MM.yyyy HH:mm")
                                            }
                                            else
                                            {
                                                <i class="bi bi-check-circle"></i> @("–ó–∞–≤–µ—Ä—à–µ–Ω")
                                            }
                                        }
                                        else
                                        {
                                            <i class="bi bi-clock"></i> @("–ù–µ —Å—ã–≥—Ä–∞–Ω")
                                        }
                                    </small>
                                    <a asp-controller="Matches" asp-action="Edit" asp-route-id="@match.Id" 
                                       class="btn btn-info btn-sm text-white">
                                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    @if (finalMatches.Any())
    {
        <div class="mb-5">
            <h3 class="text-center mb-4">
                <i class="bi bi-trophy-fill"></i> –§–∏–Ω–∞–ª
            </h3>
            <div class="row justify-content-center">
                @foreach (var match in finalMatches)
                {
                    <div class="col-md-8 col-lg-6 mb-4">
                        <div class="card h-100 border-warning @(match.IsCompleted ? "bg-light" : "")">
                            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                <span class="badge @(match.IsCompleted ? "bg-success" : "bg-danger") text-white">
                                    @(match.IsCompleted ? "–ó–∞–≤–µ—Ä—à–µ–Ω" : "–û–∂–∏–¥–∞–µ—Ç")
                                </span>
                                <h5 class="mb-0">üèÜ –§–ò–ù–ê–õ üèÜ</h5>
                            </div>
                            <div class="card-body text-center">
                                <div class="row align-items-center">
                                    <div class="col-4">
                                        <h5 class="mb-0 fw-bold">@match.HomeParticipant.Name</h5>
                                    </div>
                                    <div class="col-4 text-center">
                                        @if (match.IsCompleted)
                                        {
                                            <h3 class="mb-0 fw-bold text-warning" style="white-space: nowrap;">@(match.HomeScore ?? 0) - @(match.AwayScore ?? 0)</h3>
                                        }
                                        else
                                        {
                                            <h3 class="mb-0 text-muted">vs</h3>
                                        }
                                    </div>
                                    <div class="col-4">
                                        <h5 class="mb-0 fw-bold">@match.AwayParticipant.Name</h5>
                                    </div>
                                </div>
                                
                                @if (match.IsCompleted)
                                {
                                    <div class="mt-3">
                                        @if (match.Result == TournamentApp.Models.MatchResult.HomeWin)
                                        {
                                            <span class="badge bg-warning fs-5 text-dark">ü•á –ß–ï–ú–ü–ò–û–ù: @match.HomeParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.AwayWin)
                                        {
                                            <span class="badge bg-warning fs-5 text-dark">ü•á –ß–ï–ú–ü–ò–û–ù: @match.AwayParticipant.Name</span>
                                        }
                                        else if (match.Result == TournamentApp.Models.MatchResult.Draw)
                                        {
                                            <span class="badge bg-secondary fs-5">‚öñÔ∏è –ù–∏—á—å—è –≤ —Ñ–∏–Ω–∞–ª–µ</span>
                                        }
                                    </div>
                                }
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        @if (match.IsCompleted)
                                        {
                                            @if (match.PlayedAt.HasValue)
                                            {
                                                <i class="bi bi-calendar"></i> @match.PlayedAt.Value.ToString("dd.MM.yyyy HH:mm")
                                            }
                                            else
                                            {
                                                <i class="bi bi-check-circle"></i> @("–ó–∞–≤–µ—Ä—à–µ–Ω")
                                            }
                                        }
                                        else
                                        {
                                            <i class="bi bi-clock"></i> @("–ù–µ —Å—ã–≥—Ä–∞–Ω")
                                        }
                                    </small>
                                    <a asp-controller="Matches" asp-action="Edit" asp-route-id="@match.Id" 
                                       class="btn btn-warning btn-sm">
                                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
} 